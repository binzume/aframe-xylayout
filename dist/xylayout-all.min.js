"use strict";if("undefined"==typeof AFRAME)throw"AFRAME is not loaded.";AFRAME.registerComponent("xycontainer",{dependencies:["xyrect"],schema:{spacing:{default:.05},padding:{default:0},reverse:{default:!1},wrap:{default:"nowrap",oneOf:["wrap","nowrap"]},direction:{default:"column",oneOf:["none","row","column","vertical","horizontal"]},alignItems:{default:"none",oneOf:["none","center","start","end","baseline","stretch"]},justifyItems:{default:"start",oneOf:["center","start","end","space-between","space-around","stretch"]},alignContent:{default:"",oneOf:["","none","start","end","center","stretch"]}},init(){this.el.addEventListener("xyresize",t=>this.requestLayout()),this.requestLayout()},t(t,e){let i=this.data;if("none"===i.direction)return;let s="vertical"===i.direction||"column"===i.direction,h=i.padding,l=i.spacing,n=i.reverse^s?-1:1,a=s?[0,1,n,0]:[n,0,0,-1],o=s?(t,e)=>[e,t]:(t,e)=>[t,e],r=o(t.width-2*h,t.height-2*h),d=o("width","height"),c=[],u=0,y=0,x=0,g=0,f=0,w=0,p=[];for(let t=0;t<e.length;t++){let s=e[t],h=s.getAttribute("xyitem");if(h&&h.fixed)continue;let n=s.components.xyrect||s.getAttribute("geometry")||{width:1*(s.getAttribute("width")||void 0),height:1*(s.getAttribute("height")||void 0)},a=s.getAttribute("scale")||{x:1,y:1},d={el:s,size:o(n.width,n.height),pivot:o(n.data?n.data.pivotX:.5,n.data?n.data.pivotY:.5),scale:o(a.x,a.y)};null==d.size[0]||isNaN(d.size[0])||("wrap"==i.wrap&&u>0&&u+d.size[0]*d.scale[0]+l*c.length>r[0]&&(p.push({targets:c,sizeSum:u,growSum:y,shrinkSum:x,crossSize:g}),f+=g,w=Math.max(w,u+l*(p.length-1)),c=[],u=0,y=0,x=0,g=0),c.push(d),u+=d.size[0]*d.scale[0],y+=h?h.grow:1,x+=h?h.shrink:1,g=d.size[1]>g?d.size[1]:g)}c.length>0&&(p.push({targets:c,sizeSum:u,growSum:y,shrinkSum:x,crossSize:g}),w=Math.max(w,u+l*(p.length-1)),f+=g),f+=l*(p.length-1),-1==t.data[d[0]]&&(r[0]=w,t[d[0]]=w+2*h),-1==t.data[d[1]]&&(r[1]=f,t[d[1]]=f+2*h);let m=o(t.data.pivotX,t.data.pivotY),E=-m[1]*r[1],v=-(s?1-m[0]:m[0])*r[0],b=0,R=i.alignContent||i.alignItems;"end"==R?E+=r[1]-f:"center"==R?E+=(r[1]-f)/2:"stretch"!=R&&"none"!=R||(b=(r[1]-f)/p.length),p.forEach(t=>{r[1]=t.crossSize+b,this.i(t.targets,t.sizeSum,t.growSum,t.shrinkSum,v,E,r,a,d),E+=r[1]+l})},i(t,e,i,s,h,l,n,a,o){let{justifyItems:r,alignItems:d,spacing:c}=this.data,u=0;"center"===r?h+=(n[0]-e-c*t.length)/2:"end"===r?h+=n[0]-e-c*t.length:"stretch"===r?u=(u=n[0]-e-c*(t.length-1))>0?i>0?u/i:0:s>0?u/s:0:"space-between"===r?c=(n[0]-e)/(t.length-1):"space-around"===r&&(h+=.5*(c=(n[0]-e)/t.length));for(let e=0;e<t.length;e++){let i=t[e],s=i.el,r=s.getAttribute("xyitem"),y=r&&r.align||d,x=(r?u>0?r.grow:r.shrink:1)*u,g=i.size[0]*i.scale[0]+x,f=i.size[1],w=s.getAttribute("position")||{x:0,y:0,z:0},p=h+i.pivot[0]*g,m=l+.5*n[1];i.scale[0]>0&&0!=x&&s.setAttribute(o[0],i.size[0]+x/i.scale[0]),i.scale[1]>0&&"stretch"===y&&s.setAttribute(o[1],(f=n[1])/i.scale[1]),"start"===y||"stretch"===y?m=l+i.pivot[1]*f:"end"===y?m=l+n[1]-(1-i.pivot[1])*f:"center"===y?m+=(i.pivot[1]-.5)*f:"none"===y&&(m+=a[1]*w.x+a[3]*w.y),w.x=a[0]*p+a[1]*m,w.y=a[2]*p+a[3]*m,s.setAttribute("position",w),h+=g+c}},requestLayout(){this.data&&this.t(this.el.components.xyrect,this.el.children)}}),AFRAME.registerComponent("xyitem",{schema:{align:{default:"none",oneOf:["none","center","start","end","baseline","stretch"]},grow:{default:1},shrink:{default:1},fixed:{default:!1}},update(t){if(void 0!==t.align){let t=this.el.parent.components.xycontainer;t&&t.requestLayout()}}}),AFRAME.registerComponent("xyrect",{schema:{width:{default:-1},height:{default:-1},pivotX:{default:.5},pivotY:{default:.5}},update(t){let e=this.data,i=this.el,s=i.getAttribute("geometry")||{},h=e.width,l=e.height;h<0&&(h=i.hasAttribute("width")?1*i.getAttribute("width"):s.width||0),l<0&&(l=i.hasAttribute("height")?1*i.getAttribute("height"):s.height||0),this.width=h,this.height=l,void 0!==t.width&&i.emit("xyresize",{xyrect:this},!1)}}),AFRAME.registerPrimitive("a-xycontainer",{defaultComponents:{xyrect:{},xycontainer:{}},mappings:{width:"xyrect.width",height:"xyrect.height",direction:"xycontainer.direction",spacing:"xycontainer.spacing",padding:"xycontainer.padding",reverse:"xycontainer.reverse",wrap:"xycontainer.wrap","align-items":"xycontainer.alignItems","justify-items":"xycontainer.justifyItems"}}),AFRAME.registerGeometry("xy-rounded-rect",{schema:{height:{default:1,min:0},width:{default:1,min:0},radius:{default:.05,min:0}},init(t){let e=new THREE.Shape,i=t.radius,s=(t.width||.01)/2,h=(t.height||.01)/2;e.moveTo(-s,-h+i),e.lineTo(-s,h-i),e.quadraticCurveTo(-s,h,-s+i,h),e.lineTo(s-i,h),e.quadraticCurveTo(s,h,s,h-i),e.lineTo(s,-h+i),e.quadraticCurveTo(s,-h,s-i,-h),e.lineTo(-s+i,-h),e.quadraticCurveTo(-s,-h,-s,-h+i),this.geometry=new THREE.ShapeGeometry(e)}}),AFRAME.registerComponent("xylabel",{dependencies:["xyrect"],schema:{value:{default:""},color:{default:"white"},align:{default:"left"},wrapCount:{default:0},xOffset:{default:0},zOffset:{default:.01},resolution:{default:32},renderingMode:{default:"auto",oneOf:["auto","canvas"]}},init(){this.el.addEventListener("xyresize",t=>this.update())},update(){let t=this.data,e=t.wrapCount,i=this.el.components.xyrect,s=i.height,h=i.width;if(""==t.value)return void this.remove();if(0==e&&s>0&&(e=Math.max(h/s/.65,t.value.length)+1),"auto"==t.renderingMode&&!/[\u0100-\uDFFF]/.test(t.value)){let i=Object.assign({},t);delete i.resolution,delete i.renderingMode,i.wrapCount=e,i.width=h,i.height=s,this.el.setAttribute("text",i);let l=this.el.getObject3D("text");return l&&(l.raycast=function(){}),void this.s()}this.h();let l=Math.floor(t.resolution*(.65*e)),n=t.resolution,a=t.resolution;for(;a<l;)a<<=1;let o=this.canvas;if(!o||this.textWidth!==l||o.height!==n){this.s(),this.canvas=o=o||document.createElement("canvas"),o.height=n,o.width=a,this.textWidth=l;let s=i.data.height>0?i.height:h/(.65*e),r=new THREE.CanvasTexture(o);r.anisotropy=4,r.alphaTest=.2,r.repeat.x=l/a;let d=new THREE.Mesh(new THREE.PlaneGeometry(h,s),new THREE.MeshBasicMaterial({map:r,transparent:!0}));d.position.copy(new THREE.Vector3(t.xOffset,0,t.zOffset)),this.el.setObject3D("xylabel",d)}let r=o.getContext("2d");r.clearRect(0,0,a,n),r.font=.9*n+"px bold sans-serif",r.textBaseline="top",r.textAlign=t.align,r.fillStyle=t.color,r.fillText(t.value,"center"===t.align?l/2:0,.1*n),this.el.object3DMap.xylabel.material.map.needsUpdate=!0},remove(){this.s(),this.h()},h(){this.el.hasAttribute("text")&&this.el.removeAttribute("text")},s(){let t=this.el.getObject3D("xylabel");t&&(t.material.map.dispose(),t.material.dispose(),t.geometry.dispose(),this.el.removeObject3D("xylabel"),this.canvas=null)}}),AFRAME.registerComponent("xybutton",{dependencies:["xyrect"],schema:{color:{default:""},hoverColor:{default:""}},init(){let t=this.el.components.xyrect;this.el.sceneEl.systems.xywindow.createSimpleButton({width:t.width,height:t.height,color:this.data.color,hoverColor:this.data.hoverColor},null,this.el),this.el.addEventListener("xyresize",t=>{this.el.setAttribute("geometry",{width:t.detail.xyrect.width,height:t.detail.xyrect.height})})}}),AFRAME.registerComponent("xytoggle",{dependencies:["xyrect"],schema:{value:{default:!1}},init(){this.l={width:1,height:1},this.el.sceneEl.systems.xywindow.createSimpleButton(this.l,null,this.el),this.o=document.createElement("a-circle"),this.el.appendChild(this.o),this.el.addEventListener("click",t=>{this.el.setAttribute("xytoggle","value",!this.data.value),this.el.emit("change",{value:!this.data.value},!1)}),this.el.addEventListener("xyresize",t=>this.update())},update(){let t=this.el.components.xyrect,e=this.l,i=this.data.value;e.color=i?"#0066ff":this.el.sceneEl.systems.xywindow.theme.buttonColor,e.hoverColor=i?"#4499ff":"",this.el.setAttribute("material","color",e.color);let s=t.height/2;this.o.setAttribute("geometry","radius",.8*s),this.o.setAttribute("position",{x:(t.width/2-s)*(i?1:-1),y:0,z:.05}),this.el.setAttribute("geometry",{primitive:"xy-rounded-rect",width:t.width,height:2*s,radius:s})}}),AFRAME.registerComponent("xyselect",{dependencies:["xyrect","xybutton"],schema:{values:{default:[]},label:{default:""},toggle:{default:!1},select:{default:0}},init(){if(this.el.addEventListener("click",t=>{this.data.toggle?this.select((this.data.select+1)%this.data.values.length):this.u?this.hide():this.show()}),this.data.toggle)this.el.setAttribute("xylabel","align","center");else{let t=this.g=document.createElement("a-triangle");t.setAttribute("geometry",{vertexA:{x:.1,y:.03,z:0},vertexB:{x:-.1,y:.03,z:0},vertexC:{x:0,y:-.12,z:0}}),this.el.appendChild(t),this.el.addEventListener("xyresize",t=>this.update())}},update(){let t=this.data;this.el.setAttribute("xylabel",{value:t.label||t.values[t.select]}),this.g&&this.g.setAttribute("position",{x:this.el.components.xyrect.width/2-.2,y:0,z:.05})},show(){if(this.u)return;let t=(this.el.components.xyrect.height+.5*this.data.values.length)/2+.1;this.u=document.createElement("a-entity"),this.u.setAttribute("xycontainer",{spacing:0}),this.u.setAttribute("position",{x:0,y:t,z:.05}),this.el.appendChild(this.u),this.data.values.forEach((t,e)=>{let i=document.createElement("a-xybutton");i.setAttribute("label",t),i.addEventListener("click",t=>{t.stopPropagation(),this.select(e),this.hide()}),this.u.appendChild(i)}),setTimeout(()=>this.u&&this.u.setAttribute("xyrect",{width:2,height:.5*this.data.values.length}),0)},select(t){this.el.setAttribute("xyselect","select",t),this.el.emit("change",{value:this.data.values[t],index:t},!1)},hide(){this.u&&(this.el.removeChild(this.u),this.u.destroy(),this.u=null)}}),AFRAME.registerComponent("xy-draggable",{schema:{dragThreshold:{default:.02},preventClick:{default:!0},base:{type:"selector",default:null}},init(){this.el.classList.add(this.el.sceneEl.systems.xywindow.theme.collidableClass),this.p=this.p.bind(this),this.el.addEventListener("mousedown",this.p),this.m=null},remove(){this.el.removeEventListener("mousedown",this.p)},tick(){null!==this.m?this.m("xy-drag"):this.pause()},p(t){if(!t.detail.cursorEl||!t.detail.cursorEl.components.raycaster)return;let e=this.data.base||this.el,i=t.detail.cursorEl,s=i.components.raycaster.raycaster,h=new THREE.Plane(new THREE.Vector3(0,0,-1),0).applyMatrix4(e.object3D.matrixWorld),l=s.ray.direction.clone(),n=new THREE.Vector3;null===s.ray.intersectPlane(h,n)&&e.object3D.worldToLocal(n);let a=s.ray.clone(),o=this,r=!1,d=this.m=(t=>{if(!r){if(l.manhattanDistanceTo(s.ray.direction)<o.data.dragThreshold)return;t="xy-dragstart",o.dragging=r=!0}let d=n.clone();null!==s.ray.intersectPlane(h,n)&&e.object3D.worldToLocal(n),o.el.emit(t,{raycaster:s,point:n,prevPoint:d,prevRay:a,cursorEl:i}),a.copy(s.ray)});o.play();let c=e=>e.target!=t.target&&e.stopPropagation();window.addEventListener("mouseenter",c,!0),window.addEventListener("mouseleave",c,!0),window.addEventListener("mouseup",function t(e){if(e.detail.cursorEl==i&&(window.removeEventListener("mouseup",t),window.removeEventListener("mouseenter",c,!0),window.removeEventListener("mouseleave",c,!0),o.m=null,r)){if(o.dragging=!1,o.data.preventClick){let t=t=>t.stopPropagation();window.addEventListener("click",t,!0),setTimeout(()=>window.removeEventListener("click",t,!0),0)}setTimeout(()=>d("xy-dragend"),15)}})}}),AFRAME.registerComponent("xy-drag-control",{schema:{target:{type:"selector",default:null},draggable:{default:""},autoRotate:{default:!1},mode:{default:"grab"}},init(){this.v=this.v.bind(this),this.R=[],this.A=new THREE.Quaternion},update(t){let e=this.data.draggable;e!==t.draggable&&(this.remove(),this.R=Array.isArray(e)?e:""!=e?this.el.querySelectorAll(e):[this.el],this.R.forEach(t=>{t.setAttribute("xy-draggable",{}),t.addEventListener("xy-dragstart",this.v),t.addEventListener("xy-drag",this.v)}))},remove(){this.R.forEach(t=>{t.removeAttribute("xy-draggable"),t.removeEventListener("xy-dragstart",this.v),t.removeEventListener("xy-drag",this.v)})},v(t){let{origin:e,direction:i}=t.detail.raycaster.ray,{origin:s,direction:h}=t.detail.prevRay,l=t.detail.cursorEl,n=(this.data.target||this.el).object3D,a=new THREE.Quaternion;if(l.components["tracked-controls"]){let e=l.object3D.quaternion;"xy-dragstart"!=t.type&&a.copy(this.A).inverse().premultiply(e),this.A.copy(e)}else a.setFromUnitVectors(h,i);let o=n.parent.worldToLocal(s.clone()),r=n.parent.worldToLocal(e.clone()),d=new THREE.Matrix4,c=(new THREE.Matrix4).makeRotationFromQuaternion(a).multiply(d.makeTranslation(-o.x,-o.y,-o.z)).premultiply(d.makeTranslation(r.x,r.y,r.z));if(n.applyMatrix(c),"pull"==this.data.mode){let t=n.getWorldPosition(new THREE.Vector3),s=i.clone().sub(h),l=2*t.distanceTo(e);n.position.add(i.clone().multiplyScalar(-s.y*l))}if(this.data.autoRotate){let e=this.el.sceneEl.camera.getWorldPosition(new THREE.Vector3),i=n.getWorldPosition(new THREE.Vector3),s=e.clone().sub(i).normalize(),h=.8-s.y*s.y;if(h>0){c.lookAt(e,i,new THREE.Vector3(0,1,0));let s=l.components.raycaster.getIntersection(t.target),o=n.parent.worldToLocal(s?s.point:i),r=n.quaternion.clone();n.quaternion.slerp(a.setFromRotationMatrix(c),.1*h),n.position.sub(o).applyQuaternion(r.inverse().premultiply(n.quaternion)).add(o)}}}}),AFRAME.registerComponent("xywindow",{dependencies:["xycontainer"],schema:{title:{default:""},closable:{default:!0}},init(){let t=this.system.theme,e=this.controls=document.createElement("a-entity");if(e.setAttribute("position",{x:0,y:0,z:.05}),e.setAttribute("xyitem",{fixed:!0}),this.el.appendChild(e),(this.M=this.system.createSimpleButton({width:1,height:.5,color:t.windowTitleBarColor},e)).setAttribute("xy-drag-control",{target:this.el,autoRotate:!0}),this.T=document.createElement("a-entity"),this.M.appendChild(this.T),this.data.closable){let i=this.system.createSimpleButton({width:.5,height:.5,color:t.windowTitleBarColor,hoverColor:t.windowCloseButtonColor},e);i.setAttribute("xylabel",{value:"X",align:"center",color:t.buttonLabelColor}),i.addEventListener("click",t=>this.el.parentNode.removeChild(this.el)),this.H=i}this.el.addEventListener("xyresize",t=>{this.update({})}),this.system.registerWindow(this)},remove(){this.system.unregisterWindow(this)},update(t){let e=this.el.components.xyrect,i=0;if(this.H&&(this.H.setAttribute("position",{x:e.width/2-.25,y:.3,z:0}),i+=.52),this.data.title!=t.title){let t=e.width-i-.2;this.T.setAttribute("xyrect",{width:t,height:.45}),this.T.setAttribute("xylabel",{value:this.data.title,wrapCount:Math.max(10,t/.2),color:this.system.theme.windowTitleColor,xOffset:.1})}this.controls.setAttribute("position","y",.5*e.height),this.M.setAttribute("geometry","width",e.width-i),this.M.setAttribute("position",{x:-i/2,y:.3,z:0})},setTitle(t){this.el.setAttribute("xywindow","title",t)}}),AFRAME.registerSystem("xywindow",{theme:{buttonColor:"#222",buttonHoverColor:"#333",buttonLabelColor:"#fff",buttonHoverHaptic:.3,buttonHoverHapticMs:10,buttonGeometry:"xy-rounded-rect",windowCloseButtonColor:"#f00",windowTitleBarColor:"#111",windowTitleColor:"#fff",collidableClass:"collidable"},windows:[],createSimpleButton(t,e,i){let s=i||document.createElement("a-entity");return s.hasAttribute("geometry")||s.setAttribute("geometry",{primitive:this.theme.buttonGeometry,width:t.width,height:t.height}),s.classList.add(this.theme.collidableClass),s.addEventListener("mouseenter",e=>{let i=this.theme;if(s.setAttribute("material",{color:t.hoverColor||this.theme.buttonHoverColor}),i.buttonHoverHaptic&&e.detail.cursorEl.components["tracked-controls"]){let t=e.detail.cursorEl.components["tracked-controls"].controller;t&&t.hapticActuators&&t.hapticActuators.length>0&&t.hapticActuators[0].pulse(i.buttonHoverHaptic,i.buttonHoverHapticMs)}}),s.addEventListener("mouseleave",e=>{s.setAttribute("material",{color:t.color||this.theme.buttonColor})}),s.setAttribute("material",{color:t.color||this.theme.buttonColor}),e&&e.appendChild(s),s},registerWindow(t){this.windows.push(t)},unregisterWindow(t){let e=this.windows.indexOf(t);e>=0&&this.windows.splice(e,1)}}),AFRAME.registerComponent("xyrange",{dependencies:["xyrect"],schema:{min:{default:0},max:{default:100},step:{default:0},value:{default:0},color0:{default:"white"},color1:{default:"#06f"},thumbSize:{default:.4}},init(){let t=this.data,e=new THREE.PlaneGeometry(1,.08),i=this.C=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:t.color0})),s=this.F=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:t.color1}));s.position.z=.02,this.el.setObject3D("xyrange-bar",i),this.el.setObject3D("xyrange-prog",s),this.o=this.el.sceneEl.systems.xywindow.createSimpleButton({width:t.thumbSize,height:t.thumbSize},this.el),this.o.setAttribute("xy-draggable",{base:this.el}),this.o.addEventListener("xy-drag",e=>{let i=this.el.components.xyrect.width-t.thumbSize,s=(e.detail.point.x+i/2)/i*(t.max-t.min);t.step>0&&(s=Math.round(s/t.step)*t.step),this.setValue(s+t.min,!0)})},update(){let t=this.data;if(this.value=t.value,t.max<=t.min)return;let e=this.el.components.xyrect.width-t.thumbSize,i=e*(t.value-t.min)/(t.max-t.min);this.o.setAttribute("geometry","radius",t.thumbSize/2),this.o.setAttribute("position",{x:i-e/2,y:0,z:.04}),this.C.scale.x=e,this.F.scale.x=i||.01,this.F.position.x=(i-e)/2},setValue(t,e){if(!this.o.components["xy-draggable"].dragging||e){let i=Math.max(Math.min(t,this.data.max),this.data.min);i!=this.value&&e&&this.el.emit("change",{value:i},!1),this.el.setAttribute("xyrange","value",i)}}}),AFRAME.registerComponent("xyclipping",{dependencies:["xyrect"],schema:{exclude:{type:"selector",default:null},clipTop:{default:!0},clipBottom:{default:!0},clipLeft:{default:!1},clipRight:{default:!1}},init(){this.el.sceneEl.renderer.localClippingEnabled=!0,this.k=[],this.S=[],this.O=null,this._=this._.bind(this),this.I=["click","mousedown","mouseenter","mouseleave","mousemove"],this.I.forEach(t=>this.el.addEventListener(t,this._,!0))},update(){let t=this.el.components.xyrect,e=[];this.data.clipBottom&&e.push(new THREE.Plane(new THREE.Vector3(0,1,0),0)),this.data.clipTop&&e.push(new THREE.Plane(new THREE.Vector3(0,-1,0),t.height)),this.data.clipLeft&&e.push(new THREE.Plane(new THREE.Vector3(1,0,0),0)),this.data.clipRight&&e.push(new THREE.Plane(new THREE.Vector3(-1,0,0),t.width)),this.k=e,this.S=[],this.j()},remove(){this.I.forEach(t=>this.el.removeEventListener(t,this._,!0)),this.S=[],this.applyClippings()},tick(){this.el.object3D.matrixWorld.equals(this.O)||this.j()},_(t){if(!(t.path||t.composedPath()).includes(this.data.exclude)&&t.detail.intersection&&this.isClipped(t.detail.intersection.point)&&(t.stopPropagation(),t.detail.cursorEl&&t.detail.cursorEl.components.raycaster)){let e=t.detail.cursorEl.components.raycaster.intersectedEls,i=e.lastIndexOf(t.target);i>=0&&i+1<e.length&&e[i+1].dispatchEvent(new CustomEvent(t.type,t))}},j(){this.O=this.el.object3D.matrixWorld.clone();for(let t=0;t<this.k.length;t++)this.S[t]=this.k[t].clone().applyMatrix4(this.O);this.applyClippings()},applyClippings(){let t=this.data.exclude&&this.data.exclude.object3D,e=i=>{if(i!==t){i.material&&void 0!==i.material.clippingPlanes&&(i.material.clippingPlanes=this.S);for(let t=0;t<i.children.length;t++)e(i.children[t])}};e(this.el.object3D)},isClipped(t){return this.S.some(e=>e.distanceToPoint(t)<0)}}),AFRAME.registerComponent("xyscroll",{dependencies:["xyrect"],schema:{scrollbar:{default:!0}},init(){this.B=0,this.L=0,this.X=0,this.N=0,this.V=.2,this.W=this.Y(this.el,.3),this.el.setAttribute("xyclipping",{exclude:this.W}),this.el.setAttribute("xy-draggable",{}),this.el.addEventListener("xy-drag",t=>{this.X=0,this.setScroll(this.B,this.L+t.detail.point.y-t.detail.prevPoint.y)}),this.el.addEventListener("xy-dragend",t=>{this.X=t.detail.point.y-t.detail.prevPoint.y,this.play()}),this.el.addEventListener("xyresize",t=>this.update());let t=this.el.children;for(let e=0;e<t.length;e++)t[e]!=this.W&&t[e].addEventListener("xyresize",t=>this.update())},Y(t,e){let i=document.createElement("a-entity");t.appendChild(i),this.P=i;let s=this.el.sceneEl.systems.xywindow;return this.q=s.createSimpleButton({width:e,height:.3},i),this.q.addEventListener("click",t=>{this.X=.3*-this.D,this.play()}),this.G=s.createSimpleButton({width:e,height:.3},i),this.G.addEventListener("click",t=>{this.X=.3*this.D,this.play()}),this.J=s.createSimpleButton({width:.7*e,height:this.V},i),this.J.setAttribute("xy-draggable",{base:i}),this.J.addEventListener("xy-drag",t=>{let e=this.V,i=(this.K-e/2-t.detail.point.y)*Math.max(.01,this.N-this.el.components.xyrect.height)/(this.U-e);this.setScroll(this.B,i)}),i},update(){let t=this.el.components.xyrect,e=t.height;this.P.setAttribute("visible",this.data.scrollbar),this.P.setAttribute("position",{x:t.width+.1,y:0,z:.05}),this.q.setAttribute("position",{x:0,y:e-.15,z:0}),this.G.setAttribute("position",{x:0,y:.15,z:0}),this.D=Math.max(e/2,.5),this.K=e-.3,this.U=e-.6,this.setScroll(0,0)},tick(){Math.abs(this.X)>.001?(this.setScroll(this.B,this.L+this.X),this.X*=.8):this.pause()},setScroll(t,e){let i=this.el.children,s=0;for(let t=0;t<i.length;t++){let e=i[t];e!==this.W&&(e.components.xyrect||e.setAttribute("xyrect",{}),s=Math.max(s,e.components.xyrect.height))}this.N=s;let h=this.el.components.xyrect;this.B=Math.max(0,t),this.L=Math.max(0,Math.min(e,s-h.height));let l=Math.max(.2,Math.min(this.U*h.height/s,this.U)),n=this.K-l/2-(this.U-l)*this.L/Math.max(.01,s-h.height);this.V=l,this.J.hasAttribute("geometry")&&this.J.setAttribute("geometry","height",l),this.J.setAttribute("position","y",n);for(let t=0;t<i.length;t++){let e=i[t];if(e===this.W)continue;if(e.components.xyitem&&e.components.xyitem.data.fixed)continue;let s=e.getAttribute("position"),l=e.components.xyrect;s.x=l.data.pivotX*l.width-this.B,s.y=this.L-(1-l.data.pivotY)*l.height+h.height,e.setAttribute("position",s);let n=l.height-this.L;e.emit("xyviewport",[n,n-h.height,this.B,this.B+h.width],!1)}this.el.components.xyclipping&&this.el.components.xyclipping.applyClippings()}}),AFRAME.registerComponent("xylist",{dependencies:["xyrect"],schema:{itemWidth:{default:-1},itemHeight:{default:-1},vertical:{default:!0}},init(){this.Z=null,this.$=null,this.elements=[],this.tt=null,this.itemCount=0,this.el.setAttribute("xyrect",{pivotX:0,pivotY:0}),this.setViewPort([0,0]),this.el.addEventListener("xyviewport",t=>this.setViewPort(t.detail)),this.el.classList.add(this.el.sceneEl.systems.xywindow.theme.collidableClass),this.el.addEventListener("click",t=>{let e=t.path||t.composedPath();for(let i=0;i<e.length;i++){let s=e[i].dataset.listPosition;if(null!=s&&-1!=s){this.el.emit("clickitem",{index:s,ev:t},!1);break}}})},setCallback(t,e){if(this.Z=t,this.$=e,this.data.itemHeight<=0){let t=this.Z(this.el,this.tt);this.data.itemHeight=1*t.getAttribute("height"),this.data.itemWidth=1*t.getAttribute("width")}},setContents(t,e){this.tt=t,this.itemCount=void 0!==e?e:t.length,this.el.setAttribute("xyrect",{width:this.data.itemWidth,height:this.data.itemHeight*this.itemCount});for(let t of this.elements)t.setAttribute("visible",!1),t.dataset.listPosition=-1;this.refresh()},setViewPort(t){this.top=t[0],this.bottom=t[1],this.refresh()},refresh(){if(!this.Z)return;let t=this.data.itemHeight,e=t*this.itemCount,i=Math.max(Math.floor((e-this.top)/t),0),s=Math.min(Math.ceil((e-this.bottom)/t),this.itemCount),h=s-i+1;for(;h>this.elements.length;){let t=this.Z(this.el,this.tt);t.classList.add(this.el.sceneEl.systems.xywindow.theme.collidableClass),this.el.appendChild(t),this.elements.push(t)}let l=!1;for(let e=i;e<s;e++){let i=this.elements[e%this.elements.length];if(i.hasLoaded){if(i.dataset.listPosition!=e){i.dataset.listPosition=e;let s=0,h=(this.itemCount-e-1)*t,l=i.components.xyrect;l&&(s+=l.data.pivotX*l.width,h+=l.data.pivotY*l.height),i.setAttribute("position",{x:s,y:h,z:0}),this.$&&this.$(e,i,this.tt)}}else l=!0}l&&setTimeout(()=>this.refresh(),100);for(let t of this.elements){let e=t.dataset.listPosition;t.setAttribute("visible",e>=i&&e<s)}}}),AFRAME.registerComponent("xycanvas",{schema:{width:{default:100},height:{default:100}},init(){this.canvas=document.createElement("canvas"),this.canvas.id="_CANVAS"+Math.random();let t=new THREE.CanvasTexture(this.canvas);this.updateTexture=function(){t.needsUpdate=!0},this.el.setAttribute("material",{shader:"flat",npot:!0,src:t,transparent:!0})},update(){this.canvas.width=this.data.width,this.canvas.height=this.data.height}}),AFRAME.registerPrimitive("a-xylabel",{defaultComponents:{xyrect:{},xylabel:{}},mappings:{width:"xyrect.width",height:"xyrect.height",value:"xylabel.value",color:"xylabel.color",align:"xylabel.align","wrap-count":"xylabel.wrapCount"}}),AFRAME.registerPrimitive("a-xybutton",{defaultComponents:{xyrect:{width:2,height:.5},xylabel:{align:"center"},xybutton:{}},mappings:{width:"xyrect.width",height:"xyrect.height",label:"xylabel.value",align:"xylabel.align"}}),AFRAME.registerPrimitive("a-xytoggle",{defaultComponents:{xyrect:{width:.8,height:.4},xytoggle:{}},mappings:{width:"xyrect.width",height:"xyrect.height",value:"xytoggle.value"}}),AFRAME.registerPrimitive("a-xyselect",{defaultComponents:{xyrect:{width:2,height:.5},xyselect:{}},mappings:{width:"xyrect.width",height:"xyrect.height",values:"xyselect.values",label:"xyselect.label",toggle:"xyselect.toggle",select:"xyselect.select"}}),AFRAME.registerPrimitive("a-xywindow",{defaultComponents:{xycontainer:{alignItems:"stretch"},xywindow:{}},mappings:{width:"xyrect.width",height:"xyrect.height",direction:"xycontainer.direction",title:"xywindow.title"}}),AFRAME.registerPrimitive("a-xyscroll",{defaultComponents:{xyrect:{pivotX:0,pivotY:1},xyscroll:{}},mappings:{width:"xyrect.width",height:"xyrect.height",scrollbar:"xyscroll.scrollbar"}}),AFRAME.registerPrimitive("a-xyrange",{defaultComponents:{xyrect:{},xyrange:{}},mappings:{width:"xyrect.width",height:"xyrect.height",min:"xyrange.min",max:"xyrange.max",step:"xyrange.step",value:"xyrange.value"}});